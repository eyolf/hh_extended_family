<?php

	use Fisharebest\Webtrees\Functions\FunctionsPrintFacts;
	use Fisharebest\Webtrees\I18N;
	use Fisharebest\Webtrees\View;

 ?>

<div class="wt-tab-hh-extended-family py-4">
    <?php if ($extfam_obj->allCount > 0): ?>
    
        <?php if ( $extfam_obj->showFamilyPart['grandparents'] ): ?>
            <div class="hh-extended-family-grandparents">
                <?php if ($extfam_obj->Grandparents->allCount): ?>
                    <h2><?= I18N::translate('Grandparents') ?></h2>
                    <?php if ($extfam_obj->Grandparents->allCount == 1): ?>
                        <?php if ($extfam_obj->Grandparents->femaleCount == 1): ?>
                            <h3><?= I18N::translate('%s has one grandmother recorded.', $extfam_obj->Self->niceName) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->Grandparents->maleCount == 1): ?>
                                <h3><?= I18N::translate('%s has one grandfather recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::translate('%s has one grandparent recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php else: ?>
                        <?php if ($extfam_obj->Grandparents->maleCount == 0): ?>
                            <h3><?= I18N::translate('%s has %d grandmothers recorded.', $extfam_obj->Self->niceName, $extfam_obj->Grandparents->femaleCount) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->Grandparents->femaleCount == 0): ?>
                                <h3><?= I18N::translate('%s has %d grandfathers recorded.', $extfam_obj->Self->niceName, $extfam_obj->Grandparents->maleCount) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::plural('%2$s has %1$d grandfather and ', '%2$s has %1$d grandfathers and ', $extfam_obj->Grandparents->maleCount, $extfam_obj->Grandparents->maleCount, $extfam_obj->Self->niceName) ?>
                                    <?= I18N::plural('%d grandmother recorded (%d in total).', '%d grandmothers recorded (%d in total).', $extfam_obj->Grandparents->femaleCount, $extfam_obj->Grandparents->femaleCount, $extfam_obj->Grandparents->allCount) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php endif ?>
                    <div id="hh_extended_family_content">
                        <?php if ($extfam_obj->Grandparents->fathersFamilyCount): ?>
                            <div id="extended_family_f">
                                <h4><?= I18N::translate('Father\'s family (%d)', $extfam_obj->Grandparents->fathersFamilyCount) ?></h4>
                                <?php $i = 1; ?>
                                <?php  foreach ($extfam_obj->Grandparents->fatherFamily as $indi) : ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>    
                        <?php endif ?>
                        <?php if ($extfam_obj->Grandparents->mothersFamilyCount): ?>
                            <div id="extended_family_m">
                                <h4><?= I18N::translate('Mother\'s family (%d)', $extfam_obj->Grandparents->mothersFamilyCount) ?></h4>
                                <?php $i = 1; ?>
                                <?php  foreach ($extfam_obj->Grandparents->motherFamily as $indi) : ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>
                        <?php endif ?>
                        <?php if ($extfam_obj->Grandparents->fathersAndMothersFamilyCount): ?>
                            <div id="extended_family_fm">
                                <h4><?= I18N::translate('Father\'s and Mother\'s family (%d)', $extfam_obj->Grandparents->fathersAndMothersFamilyCount)?></h4>
                                <?php $i = 1; ?>
                                <?php  foreach ($extfam_obj->Grandparents->fatherAndMotherFamily as $indi) : ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>
                        <?php endif ?>
                    </div>
                <?php else: ?>
                    <h3><?= I18N::translate('%s has no grandparents recorded.', $extfam_obj->Self->indi->fullName()) ?></h3>
                <?php endif ?>
            </div>
        <?php endif ?>

        <?php if ( $extfam_obj->showFamilyPart['uncles_and_aunts'] ): ?>
            <div class="hh-extended-family-uncles-aunts">
                <?php if ($extfam_obj->UnclesAunts->allCount): ?>
                    <h2><?= I18N::translate('Uncles and Aunts') ?></h2>
                    <?php if ($extfam_obj->UnclesAunts->allCount == 1): ?>
                        <?php if ($extfam_obj->UnclesAunts->femaleCount == 1): ?>
                            <h3><?= I18N::translate('%s has one aunt recorded.', $extfam_obj->Self->niceName) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->UnclesAunts->maleCount == 1): ?>
                                <h3><?= I18N::translate('%s has one uncle recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::translate('%s has one uncle or aunt recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php else: ?>
                        <?php if ($extfam_obj->UnclesAunts->maleCount == 0): ?>
                            <h3><?= I18N::translate('%s has %d aunts recorded.', $extfam_obj->Self->niceName, $extfam_obj->UnclesAunts->femaleCount) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->UnclesAunts->femaleCount == 0): ?>
                                <h3><?= I18N::translate('%s has %d uncles recorded.', $extfam_obj->Self->niceName, $extfam_obj->UnclesAunts->maleCount) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::plural('%2$s has %1$d uncle and ', '%2$s has %1$d uncles and ', $extfam_obj->UnclesAunts->maleCount, $extfam_obj->UnclesAunts->maleCount, $extfam_obj->Self->niceName) ?>
                                    <?= I18N::plural('%d aunt recorded (%d in total).', '%d aunts recorded (%d in total).', $extfam_obj->UnclesAunts->femaleCount, $extfam_obj->UnclesAunts->femaleCount, $extfam_obj->UnclesAunts->allCount) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php endif ?>
                    <div id="hh_extended_family_content">
                        <?php if ($extfam_obj->UnclesAunts->fathersFamilyCount): ?>
                            <div id="extended_family_f">
                                <h4><?= I18N::translate('Father\'s family (%d)', $extfam_obj->UnclesAunts->fathersFamilyCount) ?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php  foreach ($extfam_obj->UnclesAunts->fatherFamily as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url()); ?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                        <span class="extended_family_pedi"><?= $module_obj->getChildLabel($indi) ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>    
                        <?php endif ?>
                        <?php if ($extfam_obj->UnclesAunts->mothersFamilyCount): ?>
                            <div id="extended_family_m">
                                <h4><?= I18N::translate('Mother\'s family (%d)', $extfam_obj->UnclesAunts->mothersFamilyCount) ?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php  foreach ($extfam_obj->UnclesAunts->motherFamily as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url()); ?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                        <span class="extended_family_pedi"><?= $module_obj->getChildLabel($indi) ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>
                        <?php endif ?>
                        <?php if ($extfam_obj->UnclesAunts->fathersAndMothersFamilyCount): ?>
                            <div id="extended_family_fm">
                                <h4><?= I18N::translate('Father\'s and Mother\'s family (%d)', $extfam_obj->UnclesAunts->fathersAndMothersFamilyCount)?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php  foreach ($extfam_obj->UnclesAunts->fatherAndMotherFamily as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url()); ?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                        <span class="extended_family_pedi"><?= $module_obj->getChildLabel($indi) ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>
                        <?php endif ?>
                    </div>
                <?php else: ?>
                    <h3><?= I18N::translate('%s has no uncles or aunts recorded.', $extfam_obj->Self->indi->fullName()) ?></h3>
                <?php endif ?>
            </div>
        <?php endif ?>
        
        <?php if ( $extfam_obj->showFamilyPart['cousins'] ): ?>
            <div class="hh-extended-family-cousins">
                <?php if ($extfam_obj->Cousins->allCount): ?>
                    <h2><?= I18N::translate('Cousins') ?></h2>
                    <?php if ($extfam_obj->Cousins->allCount == 1): ?>
                        <?php if ($extfam_obj->Cousins->femaleCount == 1): ?>
                            <h3><?= I18N::translate('%s has one female first cousin recorded.', $extfam_obj->Self->niceName) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->Cousins->maleCount == 1): ?>
                                <h3><?= I18N::translate('%s has one male first cousin recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::translate('%s has one first cousin recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php else: ?>
                        <?php if ($extfam_obj->Cousins->maleCount == 0): ?>
                            <h3><?= I18N::translate('%s has %d female first cousins recorded.', $extfam_obj->Self->niceName, $extfam_obj->Cousins->femaleCount) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->Cousins->femaleCount == 0): ?>
                                <h3><?= I18N::translate('%s has %d male first cousins recorded.', $extfam_obj->Self->niceName, $extfam_obj->Cousins->maleCount) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::plural('%2$s has %1$d male first cousin and ', '%2$s has %1$d male first cousins and ', $extfam_obj->Cousins->maleCount, $extfam_obj->Cousins->maleCount, $extfam_obj->Self->niceName) ?>
                                    <?= I18N::plural('%d female first cousin recorded (%d in total).', '%d female first cousins recorded (%d in total).', $extfam_obj->Cousins->femaleCount, $extfam_obj->Cousins->femaleCount, $extfam_obj->Cousins->allCount) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php endif ?>
                    <div id="hh_extended_family_content">
                        <?php if ($extfam_obj->Cousins->fathersFamilyCount): ?>
                            <div id="extended_family_f">
                                <h4><?= I18N::translate('Father\'s family (%d)', $extfam_obj->Cousins->fathersFamilyCount) ?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php  foreach ($extfam_obj->Cousins->fatherFamily as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url()); ?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                        <span class="extended_family_pedi"><?= $module_obj->getChildLabel($indi) ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>    
                        <?php endif ?>
                        <?php if ($extfam_obj->Cousins->mothersFamilyCount): ?>
                            <div id="extended_family_m">
                                <h4><?= I18N::translate('Mother\'s family (%d)', $extfam_obj->Cousins->mothersFamilyCount) ?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php  foreach ($extfam_obj->Cousins->motherFamily as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url()); ?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                        <span class="extended_family_pedi"><?= $module_obj->getChildLabel($indi) ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>
                        <?php endif ?>
                        <?php if ($extfam_obj->Cousins->fathersAndMothersFamilyCount): ?>
                            <div id="extended_family_fm">
                                <h4><?= I18N::translate('Father\'s and Mother\'s family (%d)', $extfam_obj->Cousins->fathersAndMothersFamilyCount)?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php  foreach ($extfam_obj->Cousins->fatherAndMotherFamily as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url()); ?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                        <span class="extended_family_pedi"><?= $module_obj->getChildLabel($indi) ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>
                        <?php endif ?>
                    </div>
                <?php else: ?>
                    <h3><?= I18N::translate('%s has no first cousins recorded.', $extfam_obj->Self->indi->fullName()) ?></h3>
                <?php endif ?>
            </div>
        <?php endif ?>
        
        <?php if ( $extfam_obj->showFamilyPart['children'] ): ?>
            <div class="hh-extended-family-children">
                <?php if ($extfam_obj->Children->allCount): ?>
                    <h2><?= I18N::translate('Children') ?></h2>
                    <?php if ($extfam_obj->Children->allCount == 1): ?>
                        <?php if ($extfam_obj->Children->femaleCount == 1): ?>
                            <h3><?= I18N::translate('%s has one daughter recorded.', $extfam_obj->Self->niceName) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->Children->maleCount == 1): ?>
                                <h3><?= I18N::translate('%s has one son recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::translate('%s has one child recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php else: ?>
                        <?php if ($extfam_obj->Children->maleCount == 0): ?>
                            <h3><?= I18N::translate('%s has %d daughters recorded.', $extfam_obj->Self->niceName, $extfam_obj->Children->femaleCount) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->Children->femaleCount == 0): ?>
                                <h3><?= I18N::translate('%s has %d sons recorded.', $extfam_obj->Self->niceName, $extfam_obj->Children->maleCount) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::plural('%2$s has %1$d son and ', '%2$s has %1$d sons and ', $extfam_obj->Children->maleCount, $extfam_obj->Children->maleCount, $extfam_obj->Self->niceName) ?>
                                    <?= I18N::plural('%d daughter recorded (%d in total).', '%d daughters recorded (%d in total).', $extfam_obj->Children->femaleCount, $extfam_obj->Children->femaleCount, $extfam_obj->Children->allCount) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php endif ?>
                    <div id="hh_extended_family_content">
                        <?php foreach ($extfam_obj->Children->families as $family): ?>
                            <div id="extended_family_g">
                                <h4><?= I18N::translate(/*'Family with x / Family x and y'*/'') ?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php $i = 1; ?>
                                <?php  foreach ($extfam_obj->Children->families[0]->members as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url());?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>    
                        <?php endforeach ?>
                    </div>
                <?php else: ?>
                    <h3><?= I18N::translate('%s has no children recorded.', $extfam_obj->Self->indi->fullName()) ?></h3>
                <?php endif ?>
            </div>
        <?php endif ?>
        
        <?php if ( $extfam_obj->showFamilyPart['nephews_and_nieces'] ): ?>
            <div class="hh-extended-family-nephews-nieces">
                <?php if ($extfam_obj->NephewsNieces->allCount): ?>
                    <h2><?= I18N::translate('Nephews and Nieces') ?></h2>
                    <?php if ($extfam_obj->NephewsNieces->allCount == 1): ?>
                        <?php if ($extfam_obj->NephewsNieces->femaleCount == 1): ?>
                            <h3><?= I18N::translate('%s has one niece recorded.', $extfam_obj->Self->niceName) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->NephewsNieces->maleCount == 1): ?>
                                <h3><?= I18N::translate('%s has one nephew recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::translate('%s has one nephew or niece recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php else: ?>
                        <?php if ($extfam_obj->NephewsNieces->maleCount == 0): ?>
                            <h3><?= I18N::translate('%s has %d nieces recorded.', $extfam_obj->Self->niceName, $extfam_obj->NephewsNieces->femaleCount) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->NephewsNieces->femaleCount == 0): ?>
                                <h3><?= I18N::translate('%s has %d nephews recorded.', $extfam_obj->Self->niceName, $extfam_obj->NephewsNieces->maleCount) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::plural('%2$s has %1$d nephew and ', '%2$s has %1$d nephews and ', $extfam_obj->NephewsNieces->maleCount, $extfam_obj->NephewsNieces->maleCount, $extfam_obj->Self->niceName) ?>
                                    <?= I18N::plural('%d niece recorded (%d in total).', '%d nieces recorded (%d in total).', $extfam_obj->NephewsNieces->femaleCount, $extfam_obj->NephewsNieces->femaleCount, $extfam_obj->NephewsNieces->allCount) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php endif ?>
                    <div id="hh_extended_family_content">
                        <?php foreach ($extfam_obj->NephewsNieces->families as $family): ?>
                            <div id="extended_family_g">
                                <h4><?= I18N::translate(/*'Family with x / Family x and y'*/'') ?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php $i = 1; ?>
                                <?php  foreach ($extfam_obj->NephewsNieces->families[0]->members as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url()); ?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>    
                        <?php endforeach ?>
                    </div>
                <?php else: ?>
                    <h3><?= I18N::translate('%s has no nephews or nieces recorded.', $extfam_obj->Self->indi->fullName()) ?></h3>
                <?php endif ?>
            </div>
        <?php endif ?>
        
        <?php if ( $extfam_obj->showFamilyPart['grandchildren'] ): ?>
            <div class="hh-extended-family-grandchildren">
                <?php if ($extfam_obj->Grandchildren->allCount): ?>
                    <h2><?= I18N::translate('Grandchildren') ?></h2>
                    <?php if ($extfam_obj->Grandchildren->allCount == 1): ?>
                        <?php if ($extfam_obj->Grandchildren->femaleCount == 1): ?>
                            <h3><?= I18N::translate('%s has one female grandchild recorded.', $extfam_obj->Self->niceName) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->Grandchildren->maleCount == 1): ?>
                                <h3><?= I18N::translate('%s has one male grandchild recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::translate('%s has one grandchild recorded.', $extfam_obj->Self->niceName) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php else: ?>
                        <?php if ($extfam_obj->Grandchildren->maleCount == 0): ?>
                            <h3><?= I18N::translate('%s has %d female grandchildren recorded.', $extfam_obj->Self->niceName, $extfam_obj->Grandchildren->femaleCount) ?></h3>
                        <?php else: ?>
                            <?php if ($extfam_obj->Grandchildren->femaleCount == 0): ?>
                                <h3><?= I18N::translate('%s has %d male grandchildren recorded.', $extfam_obj->Self->niceName, $extfam_obj->Grandchildren->maleCount) ?></h3>
                            <?php else: ?>
                                <h3><?= I18N::plural('%2$s has %1$d male grandchild and ', '%2$s has %1$d male grandchildren and ', $extfam_obj->Grandchildren->maleCount, $extfam_obj->Grandchildren->maleCount, $extfam_obj->Self->niceName) ?>
                                    <?= I18N::plural('%d female grandchild recorded (%d in total).', '%d female grandchildren recorded (%d in total).', $extfam_obj->Grandchildren->femaleCount, $extfam_obj->Grandchildren->femaleCount, $extfam_obj->Grandchildren->allCount) ?></h3>
                            <?php endif ?>
                        <?php endif ?>
                    <?php endif ?>
                    <div id="hh_extended_family_content">
                        <?php foreach ($extfam_obj->Grandchildren->families as $family): ?>
                            <div id="extended_family_g">
                                <h4><?= I18N::translate(/*'Family with x / Family x and y'*/'') ?></h4>
                                <?php $prev_fam_id = '-1'; ?>
                                <?php $i = 1; ?>
                                <?php  foreach ($extfam_obj->Grandchildren->families[0]->members as $indi) : ?>
                                    <?php if ($indi->childFamilies()->first()->xref() != $prev_fam_id) : ?>
                                        <?php $prev_fam_id = $indi->childFamilies()->first()->xref(); $i = 1; ?>
                                        <h5><?= /* I18N: Do not translate. Already in webtrees core */ I18N::translate('Parents') ?><a href="<?= e($indi->childFamilies()->first()->url());?>">&nbsp;<?= $indi->childFamilies()->first()->fullName(); ?></a></h5>
                                    <?php endif ?>
                                    <div class="wt-chart-box-<?= strtolower($indi->sex()) ?>">
                                        <span class="extended_family_counter"><?= $i ?> </span>
                                        <?php if ($indi->canShow()): ?>
                                            <span class="extended_family_name"><a href="<?= e($indi->url()) ?>"><?= $indi->fullName() ?></a></span>
                                        <?php else: ?>
                                            <span class="extended_family_name"><?= $indi->fullName() ?></span>
                                        <?php endif ?>
                                        <span class="extended_family_lifespan" ><?= $indi->lifespan() ?></span>
                                    </div>
                                <?php $i++; endforeach ?>
                            </div>    
                        <?php endforeach ?>
                    </div>
                <?php else: ?>
                    <h3><?= I18N::translate('%s has no grandchildren recorded.', $extfam_obj->Self->indi->fullName()) ?></h3>
                <?php endif ?>
            </div>
        <?php endif ?>
        
    <?php else: ?>
        <h3><?= I18N::translate('No family available') ?></h3>
    <?php endif ?>
</div>

<?php View::push('javascript') ?>
<script>
  var newSheet=document.createElement("link");
  newSheet.setAttribute("rel","stylesheet");
  newSheet.setAttribute("type","text/css");
  newSheet.setAttribute("href","<?= $extended_family_css ?>");
  document.head.appendChild(newSheet);
</script>
<?php View::endpush() ?>
